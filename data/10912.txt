No criminal charges will be filed in a friendly-fire shootout that left an ATF agent dead after he tried to intervene in a New Year’s Eve pharmacy shooting, a prosecutor announced Monday.

Nassau County District Attorney Kathleen Rice issued an 11-page report noting that two bystanders who ran to the pharmacy – an off-duty New York City police officer and a retired Nassau police lieutenant – were justified when they used deadly force.

The two men were in a deli in Seaford, about 25 miles east of New York City, when someone said a robbery was in progress up the street, authorities said.

When they arrived at the pharmacy, they saw Bureau of Alcohol, Tobacco, Firearms and Explosives Agent John Capano and the robbery suspect wrestling for a gun that later turned out to be Capano’s.

The retired lieutenant, Christopher Geraghty, told investigators he opened fire, killing Capano, after a bullet from Capano’s weapon whizzed past his head. NYPD officer Joseph Arbia then killed the robbery suspect, James McGoey.

Rice’s report noted that Geraghty repeatedly yelled at Capano and McGoey to drop the gun and joined the skirmish on the sidewalk. Geraghty also continued to yell, “Police,” and repeatedly shouted for someone to tell him “who’s the good guy,” ”who’s the bad guy,” according to the report.

“He clearly did not enter this situation with the intent to use deadly physical force,” the report noted. “And he resorted to it only when he perceived that his own life was in danger.”

The report noted Geraghty “found himself looking down the barrel of a gun that he perceived to have been pointed at him by John Capano. Geraghty then believed that Capano was attempting to kill him. That belief may have been mistaken, but it was not objectively unreasonable.”

Geraghty put his own gun to Capano’s rib cage and fired.

Meanwhile, McGoey refused to show his hands after Arbia ordered him to do so, the report said. Arbia fired three shots at McGoey, killing him.

The report noted that some witnesses said Geraghty fired before Capano’s weapon went off, but investigators were not able to confirm the sequence. The report said there was no “suggestion or even a suspicion of lying on the part of any witnesses,” including Geraghty.

“These are differences in reporting that result from the varying perceptions of different people, arriving at the scene at different times, and with different information, different levels of awareness, and different expectations,” the report said.

Capano, 51, was an explosives expert who served in Iraq and Afghanistan. He had gone to the pharmacy to fill a prescription for his cancer-stricken father. He was the first ATF agent to be killed by gunfire in the line of duty since the infamous raid on a religious cult compound in Waco, Texas, in 1993.

“Special Agent John Capano was an honorable man who died when he bravely intervened to stop a dangerous criminal and my thoughts and prayers continue to be with his family and friends as they cope with this tragic loss,” Rice said in a statement Monday.

Joseph Anarumo, the ATF Special Agent in Charge of the New York field division, said in a statement the agency appreciated the thorough investigation.

“The fact remains that the responsibility for the tragic events that occurred on Dec. 31, 2011, lies with the career criminal who chose to resume his life of crime,” Anarumo said. “Our focus remains on supporting the Capano family and honoring” Capano.

McGoey had four robbery convictions on his record, three of which were pharmacy holdups, dating to 1990, court records indicate.

Geraghty’s attorney, Brian Davis, said in January the shooting will be with Geraghty for the rest of his life. A spokesman for the NYPD Patrolman’s Benevolent Association declined to comment on behalf of Arbia.

The shooting was one of two deadly Long Island pharmacy holdups last year. In June 2011, a gunman opened fire in a Medford drugstore, killing two employees and two customers before fleeing with a backpack filled with painkillers.

Armed robberies at pharmacies in the US rose 81 percent between 2006 and 2010, from 380 to 686, according to the US Drug Enforcement Administration.