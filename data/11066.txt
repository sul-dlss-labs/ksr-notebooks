An NYPD detective was shot in the arm during a wild gun battle in a Harlem subway station yesterday — but he was amazingly able to return fire and kill the suspect, officials said.

Career criminal Michael McBride and Queens Detective Kevin Herlihy exchanged 19 shots during the 4:20 p.m. violence — sending terrified straphangers running for cover in the crowded station at St. Nicholas Avenue and West 145th Street.

McBride, 52 — who was wanted for shooting his ex-girlfriend’s daughter in the head Monday — died at the scene with a bullet to the chest.

Herlihy, 47, who was part of a five-man team hunting McBride, was rushed to Columbia-Presbyterian Hospital in stable condition. He’s expected to be released from the hospital Wednesday.

“I’m OK, I’m all right,’’ the 20-year veteran, who was up and walking, told police pals at his bedside. “It all happened so quick.’’

His Valentine sweetheart, wife Adrienne, with whom he has two sons, 11 and 6, and a daughter, 13 months, was by his side, too.

The mayhem erupted as Herlihy and his team from the Queens Violent Felony Squad used McBride’s cellphone to track him to the neighborhood where he used to live.

They followed the phone’s pings all over lower Manhattan to The Bronx to Harlem before spotting him in an upper Manhattan Starbucks buying coffee, sources said.

It was apparently clear that he knew he was wanted. He was carrying his .22-caliber pistol wrapped in a newspaper at the time, sources said.

“There he is!’’ one of the detectives said upon spotting him.

As the officers started to move in, McBride began running into the subway.

Sources said he had been on parole for a 1989 robbery for which he’d served 18 years before getting out in 2007 — and had just been busted last week for drug possession in Times Square.

He sold a white powdery substance believed to be cocaine to an undercover cop on Feb. 9. But it was tested and turned out not to be drugs so the DA declined to prosecute.

Police Commissioner Ray Kelly, who rushed to the hospital to see Herlihy, said the detectives jumped into action immediately because “they were concerned he’d get on the subway. “

McBride got into the station and was cutting across in front of the clerk’s booth to race up another set of stairs to the street, with Herlihy in pursuit, amid bustling rush-hour foot traffic, sources said.

Just as he was about to climb up, the perp whipped around and immediately began blasting — firing six shots, officials said.

One of the bullets struck Herlihy, who lives in Lynbrook, LI, in the left bicep, authorities said.

The injured Herlihy, who is right-handed, managed to fire back using his uninjured arm, squeezing off 13 shots, the sources said. None of the other cops, who were trailing Herlihy, fired.

“I heard the shots . . . and when I turned around, I saw somebody dead. He was on the landing face-down in blood,’’ said witness Edwin Pagan, 47.

After McBride was struck, he managed to stumble up one flight before collapsing on a landing.

Herlihy’s brother, Vance, happened to be waiting at another station on the same line when “the ticker said [the train] was stopped for police activity.

“I didn’t know it was my brother who it was stopped for,’’ he said, adding that another brother later told him what had happened.

“He’s very lucky,’’ Vance said of his wounded brother.

McBride was declared dead at the scene, where his weapon was recovered.

His nephew, Eric, said it was clear why his uncle did what he did.

“I’ll be honest with you. My uncle was a felon. He was 52 years old,’’ the nephew told The Post.

“After doing what he did to that girl, he knew what was coming next for him. I don’t think he wanted to do life in prison. He probably thought to himself, ‘This is an all or nothing situation.’ If he was going to go down, he might as well be brought down by a cop.”

McBride had been wanted in the brutal shooting of Shante Plowden, the daughter of his estranged girlfriend, with whom he had been living until recently on Beach 100th Street in Rockaway Park, Queens, police said.

The thug went to his ex’s home at around 1:30 p.m. Monday to get some of his clothes, and that’s when he got into an argument with Plowden, sources said.

Video footage shows that the pair exchanged heated words in the ninth-floor hallway outside the apartment.

McBride then grabbed the young woman and dragged her down the hallway and out of the camera’s range, where he shot her at least once in the head and possibly again in the leg, sources said.

He can then be seen coming back into frame without her and fleeing.

Plowden, 25, remained in critical condition at North Shore Hospital in Manhasset, LI, yesterday — but was talking, even with the bullet still lodged in her head, sources said.

“It’s a miracle she’s alive,’’ a law-enforcement source said.

A friend, Tiffany Llewellyn, 25, said Plowden never talked about McBride.

“She never mentioned anything that he’s crazy,’’ she said. “This is a shocker.’’

Herlihy is the second cop shot in the city in two weeks.

Officer Kevin Brennan took a bullet to the head chasing a suspect Jan. 31, but survived.

Another cop, Peter Figoski, was fatally shot in the head while on duty in Brooklyn in December.

Mayor Bloomberg, who visited Herlihy at the hospital, hailed the cop as “the kind of detective we want out there protecting all of us.’’

Mike Palladino, head of the Detectives Endowment Association, said,

“We were very lucky . . . But if these thugs think that it’s open season on cops, I strongly recommend they think twice.”

Additional reporting by Doug Auer, Jessica Simeone, Joe Mollica, Frank Rosario and Erin Calabrese